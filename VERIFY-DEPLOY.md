# Почему на сайте нет изменений — проверка по шагам

## 1. Убедись, что на сайте новая версия

Открой свой сайт в браузере (тот URL, где должен быть барная карта).

- **Правой кнопкой → «Просмотр кода страницы»** (или Ctrl+U / Cmd+Option+U).
- В открывшемся коде нажми Ctrl+F / Cmd+F и введи: **`2025021501`** (или ищи **`deploy-version`**).

**Если этой строки нет** — на сервере всё ещё старая версия. Значит, либо деплой не запускается, либо падает, либо сайт отдаётся из другого места. Переходи к шагу 2.

**Если строка есть** — новая версия уже на сервере. Обнови страницу с принудительным сбросом кэша: **Ctrl+Shift+R** (Windows) или **Cmd+Shift+R** (Mac). После этого проверь поиск и остальные правки.

---

## 2. Проверь GitHub Actions (автодеплой)

1. Открой репозиторий: **https://github.com/YaroslavSigidin/ermitage**
2. Перейди на вкладку **Actions**.
3. Посмотри последний запуск workflow **«Deploy to Timeweb (SSH)»**.

- **Зелёная галочка** — деплой прошёл. Тогда на сервере в `/var/www/ermitage` должен быть актуальный код. Если на сайте по-прежнему старая версия, значит, nginx отдаёт файлы не из этой папки (шаг 4).
- **Красный крестик** — деплой упал. Нажми на запуск и открой упавший шаг (чаще всего «Обновить сайт на сервере»). По ошибке поймёшь причину:
  - **Permission denied (publickey)** или ошибка SSH — не настроены или неверные **Secrets**: `SSH_HOST`, `SSH_USER`, `SSH_PORT`, `SSH_PRIVATE_KEY_B64`. Инструкция в **AUTO-DEPLOY-TIMEWEB.md**.
  - **cd /var/www/ermitage: No such file or directory** — на сервере нет такой папки. Либо создай её и сделай там `git clone` своего репо, либо поменяй в workflow путь на реальную папку сайта.

---

## 3. Секреты репозитория (если деплой падает по SSH)

**Settings → Secrets and variables → Actions** в репозитории ermitage.

Должны быть созданы:

| Имя секрета           | Значение                          |
|-----------------------|-----------------------------------|
| `SSH_HOST`            | IP сервера, например `62.113.41.14` |
| `SSH_USER`            | Обычно `root`                     |
| `SSH_PORT`            | `22`                              |
| `SSH_PRIVATE_KEY_B64`  | Приватный SSH-ключ в base64       |

Как получить base64 ключа на Mac в терминале:

```bash
cat ~/.ssh/ermitage_deploy | base64
```

Скопируй **весь** вывод и вставь в значение секрета `SSH_PRIVATE_KEY_B64`. Публичный ключ этот же ключ должен быть добавлен в `~/.ssh/authorized_keys` на сервере.

После сохранения секретов снова сделай пуш в `main` или вручную запусти workflow: **Actions → Deploy to Timeweb (SSH) → Run workflow**.

---

## 4. Откуда nginx отдаёт сайт

Зайди на сервер по SSH и проверь, откуда nginx берёт файлы:

```bash
ssh root@62.113.41.14
grep -r "root\|alias" /etc/nginx/ 2>/dev/null | head -20
```

Найди директиву `root` или `alias` для твоего домена. Там будет путь, например `/var/www/ermitage` или `/var/www/html`. В workflow в шаге «Обновить сайт на сервере» в команде должно быть `cd <этот же путь>`. Сейчас в workflow указано `cd /var/www/ermitage` — если у тебя путь другой, поменяй его в `.github/workflows/deploy-timeweb.yml` в блоке `script:`.

---

## 5. Ручное обновление на сервере (если нужно проверить «здесь и сейчас»)

По SSH на сервер:

```bash
ssh root@62.113.41.14
cd /var/www/ermitage   # или путь из конфига nginx
git fetch --all
git reset --hard origin/main
```

После этого обнови страницу сайта с Ctrl+Shift+R. Если после этого изменения появились — проблема была в том, что GitHub Actions не доходил до сервера (секреты, путь, ключ). Если изменений по-прежнему нет — nginx отдаёт другую папку, смотри шаг 4.

---

## Кратко

1. **Проверка версии:** в коде страницы сайта есть `2025021501` / `deploy-version`?  
   - Нет → деплой не обновляет тот сайт, который ты смотришь.  
   - Да → жми Ctrl+Shift+R и проверяй поиск.

2. **Actions красный** → поправь Secrets и путь в workflow по этой инструкции.

3. **Ручной `git` на сервере** покажет, обновляется ли вообще папка, из которой отдаётся сайт.
